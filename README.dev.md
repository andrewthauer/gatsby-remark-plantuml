# Install node dependencies #

Installing the node depedencies only needs to be done once, and then again if
they change.

```bash
npm install
```

# How to run the tests #

```bash
npm t
```

See [How to write tests](#how-to-write-tests) for further details.

# How to visualize the tests #

To visually inspect the results of the tests you can open the svg generated by
the tests in a browser. The visualization writes the files into
`./svg/<test-name>.html`.

```
npm v
```

# How to deploy to npm repository #

The source files need to be transpiled by babel before they can be published to
the npm repository. Only the owner of the npm package can deploy.

You don't need to run the build command to develop locally, you will only need
to [run the tests](#how-to-test) and [visualize the tests](#how-to-visualize-the-tests).

```bash
npm build
npm deploy
```

# How to obtain souce code #

Follow the advice from [Cloning a repository from GitHub](https://help.github.com/en/github/creating-cloning-and-archiving-repositories/cloning-a-repository-from-github)

The repository is located at https://github.com/baerrach/gatsby-remark-plantuml.git

# How to write tests #

The tests are built with [jest](https://jestjs.io).

All test files are located in `src/__tests__/`

* `src/__tests__/index.js` tests the plugin usage
* `src/__tests__/max-width.js` tests the `max-width` feature
* `src/__tests__/sequence.js` tests the `sequence` diagram capabilities
* `src/__tests__/use-case.js` tests the `use-case` diagram capabilities

All snapshots are located in `src/__tests__/__snapshots__/<test-file-name>.js.snap` and
for each test block will contain a string for the snapshotted output. Reading
the snapshot output can be a bit tricky, the most important bit is the `value`
key which will contain the generated svg.

```
export[`test name`] = `
Object {
  "children": Array [
    Object {
      ...,
      "value": "<svg ...
```

Manually reading the svg contents is also tricky, it is better to [visualize the
tests](#how-to-visualize-the-tests) and open the resulting file in the browser
and check out the svg there.

## General boiler plate for a test file ##

```
// <Description of tests purpose>

const testRemarkPlugin = require(`../../test/test-remark-plugin`)

describe(`<Describe block for test group>`, () => {
  beforeEach(() => {
    jest.resetModules()
  })

  it(`<Single test name>`, async () => {
    const code = `
\`\`\`plantuml
@startuml
<Plant UML code to be tested>
@enduml
\`\`\`
`

    await testRemarkPlugin.testPlugin({
      code,
    })
  })
})
```

The `testRemarkPlugin` provides helpers to do all the heavy lifting in the
tests.

The `beforeEach` block is necessary to reset the jest mocking before tests are
run.

The code is tested via the `.testPlugin` call:

```
    await testRemarkPlugin.testPlugin({
      code,
    })
```

The `testPlugin` takes the provided code and makes use of [snapshot
testing](https://jestjs.io/docs/en/snapshot-testing) to compare the generated
svg with the snapshot version. It is important that you [visualize your
test](http://localhost:6419/#how-to-visualize-the-tests) to ensure it is correct
before commiting the test snapshot.

Fill in the `<blanks>` as described below.

### Description of tests purpose ###

Include the purpose of the test as a comment at the top of the file.

If this is from the <https://plantuml.com/> examples then include a link.

### Describe block for test group ###

Give a meaningful grouping of the contained tests.

If this is from the <https://plantuml.com/> examples then name it after the
heading it is contained within.

### Single test name ###

Give a meaningful name to your test.

If this is from the <https://plantuml.com/> examples then name it after the
example. Multiple examples with the same name will include a counter suffix.

### Plant UML code to be tested ###

Paste, or create yourself, the plantuml code to be tested.

If this is from the <https://plantuml.com/> examples then copy the code from the
example.

# How to view the markdown files locally #

Use [grip](https://github.com/joeyespo/grip)

